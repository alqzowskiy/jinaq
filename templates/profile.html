{% extends "base.html" %}
<!-- В начале template -->
{% block head %}
<script>
    window.userAcademicInfo = {{
        (academic_info | tojson) if academic_info else '{}' | safe
    }};
    window.userCertificates = {{
        (certificates | map(attribute = 'to_dict()') | list | tojson) if certificates else '[]' | safe
    }};
</script>
<meta name="current-username" content="{{ current_username }}">
<style>
    .profile-editable-section {
        display: none !important;
        /* Use !important for the initial state */
    }

    /* Display sections should be visible by default */
    .profile-display-section {
        display: block !important;
        /* Use !important for the initial state */
    }

    /* Add a loading overlay for the profile content */
    .profile-loading {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 100;
    }

    /* When content is ready, transition to visible */
    .profile-content-ready {
        transition: opacity 0.3s ease;
        opacity: 1;
    }

    /* Before content is ready, hide everything else */
    body:not(.profile-content-ready) #profileContent {
        opacity: 0;
    }

    /* Enhanced profile display styles */
    .profile-info-card {
        background-color: white;
        border-radius: 1rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        padding: 1.75rem;
        transition: all 0.2s ease;
    }

    .profile-info-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .profile-section {
        margin-bottom: 1.5rem;
    }

    .profile-section:last-child {
        margin-bottom: 0;
    }

    .profile-label {
        font-size: 0.925rem;
        font-weight: 600;
        color: #4b5563;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
    }

    .profile-label svg {
        margin-right: 0.5rem;
        color: #6b7280;
    }

    .profile-value {
        font-size: 1.05rem;
        color: #111827;
        line-height: 1.5;
    }

    .profile-skill-badge {
        display: inline-flex;
        padding: 0.375rem 0.75rem;
        background-color: #f3f0ff;
        color: #7c3aed;
        border-radius: 9999px;
        font-size: 0.875rem;
        font-weight: 500;
        margin-right: 0.5rem;
        margin-bottom: 0.5rem;
        transition: all 0.2s ease;
    }

    .profile-skill-badge:hover {
        background-color: #ede9fe;
        transform: translateY(-1px);
    }

    .location-display {
        display: flex;
        align-items: center;
        gap: 0.375rem;
    }

    /* Edit profile button responsive fixes */
    @media (max-width: 768px) {
        .edit-profile-container {
            position: relative;
            margin-bottom: 1rem;
            width: 100%;
        }

        #editProfileBtn {
            width: 100%;
            margin-top: 1rem;
            margin-bottom: 1rem;
        }

        .profile-main-grid {
            display: flex;
            flex-direction: column;
        }

        /* Move edit button between profile card and info card on mobile */
        .mobile-edit-button-container {
            order: 2;
        }

        .profile-info-container {
            order: 3;
        }

        .certificates-container {
            order: 4;
        }
    }

    /* Styles for the floating save button */
    .floating-save-btn {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        z-index: 100;
        display: none;
    }

    .save-btn-content {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    /* Styles for the header editor */
    .header-container {
        position: relative;
        width: 100%;
        height: 300px;
        overflow: hidden;
        border-radius: 1rem;
        margin-bottom: 2rem;
    }

    /* Toast notification styles */
    .toast-notification {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: #000;
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        z-index: 1000;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.3s ease;
    }

    .toast-notification.show {
        opacity: 1;
        transform: translateY(0);
    }

    .toast-notification.success {
        background-color: #10b981;
    }

    .toast-notification.error {
        background-color: #ef4444;
    }
</style>
{% endblock %}

{% block content %}

<div class="min-h-screen bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <!-- Header Container - Hidden by default -->
        <div id="headerContainer" class="relative w-full mb-8 hidden">
            <div
                class="relative w-full h-[300px] overflow-hidden rounded-3xl bg-gradient-to-r from-gray-100 to-gray-200 shadow-lg">
                {% if user_data.header_image %}
                <div class="absolute inset-0 bg-black/10"></div>
                <img src="{{ user_data.header_image.url }}"
                    class="w-full h-full object-cover transition-all duration-300"
                    style="object-position: {{ user_data.header_image.position or '50% 50%' }}" alt="Profile header"
                    id="headerImage">
                {% else %}
                <div class="w-full h-full bg-gradient-to-br from-gray-100 to-gray-200"></div>
                {% endif %}

                {% if session.get('user_id') == user_data.uid %}
                <div
                    class="absolute inset-0 opacity-0 hover:opacity-100 transition-all duration-300 profile-editable-section">
                    <div class="absolute inset-0 bg-black/30 backdrop-blur-sm"></div>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <label class="cursor-pointer group">
                            <div
                                class="bg-white/90 px-6 py-3 rounded-xl shadow-lg flex items-center gap-3 
                                      group-hover:bg-white transition-colors transform group-hover:scale-105 duration-200">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-700" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                                <span class="font-medium text-gray-900">Change Header</span>
                            </div>
                            <input type="file" id="headerInput" class="hidden" accept="image/*"
                                onchange="handleHeaderUpload(this)">
                        </label>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Main Content -->
        <div class="max-w-7xl mx-auto">
            <!-- Profile Action Buttons -->
            <div class="edit-profile-container flex md:justify-end mb-6">
                <button id="editProfileBtn"
                    class="btn bg-black hover:bg-gray-800 text-white transform hover:scale-[1.02] transition-all duration-200">
                    Edit Profile
                </button>
            </div>

            <div id="profileContent" class="grid grid-cols-1 md:grid-cols-3 gap-8"
                style="opacity:0;transition:opacity 0.3s ease;">
                <!-- Left Column -->
                <div class="md:col-span-1 space-y-6">
                    <!-- Profile Card - Always Visible -->
                    <div
                        class="bg-white rounded-2xl shadow-sm p-8 relative transform hover:scale-[1.01] transition-transform duration-300">
                        <div class="relative group w-40 h-40 mx-auto mb-6">
                            <img id="avatarPreview" src="{{ avatar_url }}"
                                class="w-full h-full object-cover rounded-2xl shadow-md" alt="Profile picture">

                            <label
                                class="absolute inset-0 rounded-2xl bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 flex items-center justify-center cursor-pointer transition-opacity profile-editable-section">
                                <span class="text-white text-sm font-medium">Change Photo</span>
                                <input type="file" name="avatar" accept="image/*" class="hidden"
                                    onchange="previewImage(this)">
                            </label>
                        </div>

                        <!-- Profile Info -->
                        <div class="text-center md:text-left space-y-4">
                            <div class="flex items-center justify-center md:justify-start gap-4">
                                <h1 class="text-3xl font-bold gradient-text">
                                    {{ user_data.full_name if user_data and user_data.full_name else 'Your Name' }}
                                </h1>
                                {% if user_data.verified %}
                                <div class="tooltip"
                                    data-tip="{{ 'Officially verified account' if user_data.verification_type == 'official' else 'Verified account' }}">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                        class="h-6 w-6 text-blue-500 transition-all duration-300 transform hover:scale-110 hover:rotate-6"
                                        viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd"
                                            d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                            clip-rule="evenodd" />
                                    </svg>
                                </div>
                                {% endif %}
                            </div>

                            <p class="text-gray-600 flex items-center justify-center md:justify-start gap-2">
                                @{{ user_data.username if user_data else '' }}
                                <button onclick="copyProfileLink()"
                                    class="btn btn-ghost btn-sm p-1 hover:bg-gray-100 rounded-lg"
                                    title="Copy Profile Link">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                        class="h-5 w-5 text-gray-500 hover:text-black transition-colors" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                    </svg>
                                </button>
                            </p>
                            {% if user_data.school_id %}
                            <!-- School Information for Student Profile -->
                            <div class="bg-white rounded-2xl shadow-sm p-8 space-y-6 mb-6">
                                <div class="flex items-center">
                                    {% if user_data.school_logo_url %}
                                    <div class="w-16 h-16 rounded-lg overflow-hidden mr-4">
                                        <img src="{{ user_data.school_logo_url }}" alt="{{ user_data.school_name }}"
                                            class="w-full h-full object-cover">
                                    </div>
                                    {% endif %}
                                    <div>
                                        <h2 class="text-2xl font-bold">{{ user_data.school_name }}</h2>
                                        <p class="text-gray-600">Class: {{ user_data.class }}</p>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            <div class="flex flex-wrap justify-center md:justify-start gap-2 mt-4">
                                <span
                                    class="px-4 py-2 bg-gray-100 rounded-full text-sm font-medium hover:bg-gray-200 transition-colors">
                                    {{ certificates|length }} Certificates
                                </span>
                                <span
                                    class="px-4 py-2 bg-gray-100 rounded-full text-sm font-medium hover:bg-gray-200 transition-colors">
                                    Member since {{ user_data.created_at.strftime('%B %Y') if user_data and
                                    user_data.created_at else 'Recently' }}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                        <div class="space-y-4" id="statusContainer">
                            <!-- Status Display Section -->
                            <div id="statusDisplay" class="flex items-start justify-between">
                                <div class="flex-grow">
                                    <h3 class="text-2xl font-bold mb-3">Status</h3>
                                    {% if user_data.status and user_data.status.text %}
                                    <p id="currentStatus" class="text-gray-700">{{ user_data.status.text }}</p>
                                    <p class="text-xs text-gray-500 mt-1">
                                        Updated {{ user_data.status.updated_at.strftime('%b %d, %Y at %H:%M') if
                                        user_data.status.updated_at else '' }}
                                    </p>
                                    {% else %}
                                    <p id="currentStatus" class="text-gray-500 italic">No status set. Share what you're
                                        working on or thinking about.</p>
                                    {% endif %}
                                </div>
                                <button id="editStatusBtn" onclick="showStatusEditor()"
                                    class="btn btn-ghost btn-sm profile-editable-section">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                    </svg>
                                </button>
                            </div>

                            <!-- Status Edit Section (Hidden by Default) -->
                            <div id="statusEditor" class="hidden">
                                <h3 class="text-lg font-semibold mb-2">Update your status</h3>
                                <div class="mt-2">
                                    <textarea id="statusText" class="textarea textarea-bordered w-full h-24 bg-gray-50"
                                        placeholder="Share what you're working on or thinking about..."
                                        maxlength="280">{{ user_data.status.text if user_data.status and user_data.status.text else '' }}</textarea>
                                    <div class="flex justify-between items-center mt-2">
                                        <span id="statusCharCount" class="text-sm text-gray-500">
                                            {{ (user_data.status.text|length if user_data.status and
                                            user_data.status.text else 0) }} / 280
                                        </span>
                                        <div class="flex gap-2">
                                            <button onclick="cancelStatusEdit()"
                                                class="btn btn-sm btn-ghost">Cancel</button>
                                            <button onclick="saveStatus()"
                                                class="btn btn-sm bg-black hover:bg-gray-800 text-white">Save</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Display - Visible when not editing (additional info) -->
                    <div id="profileDisplayInfo"
                        class="bg-white rounded-2xl shadow-sm p-8 space-y-6 profile-display-section">
                        <h2 class="text-2xl font-bold mb-6">Profile Information</h2>

                        <div class="space-y-4">
                            {% if user_data.specialty %}
                            <div>
                                <h3 class="font-medium text-gray-700">Specialty</h3>
                                <p class="text-gray-900">{{ user_data.specialty }}</p>
                            </div>
                            {% endif %}

                            {% if user_data.age %}
                            <div>
                                <h3 class="font-medium text-gray-700">Age</h3>
                                <p class="text-gray-900">{{ user_data.age }} years</p>
                            </div>
                            {% endif %}

                            {% if user_data.goals %}
                            <div>
                                <h3 class="font-medium text-gray-700">Goals</h3>
                                <p class="text-gray-900">{{ user_data.goals }}</p>
                            </div>
                            {% endif %}

                            {% if user_data.bio %}
                            <div>
                                <h3 class="font-medium text-gray-700">Bio</h3>
                                <p class="text-gray-900">{{ user_data.bio }}</p>
                            </div>
                            {% endif %}

                            {% if user_data.skills and user_data.skills|length > 0 %}
                            <div>
                                <h3 class="font-medium text-gray-700">Skills</h3>
                                <div class="flex flex-wrap gap-2 mt-2">
                                    {% for skill in user_data.skills %}
                                    <span
                                        class="px-3 py-1 text-sm font-medium bg-purple-50 text-purple-700 rounded-full">
                                        {{ skill }}
                                    </span>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}

                            {% if user_data.location %}
                            <div>
                                <h3 class="font-medium text-gray-700">Location</h3>
                                <p class="flex items-center gap-2 text-gray-900">
                                    <svg class="w-5 h-5 text-gray-600" fill="none" viewBox="0 0 24 24"
                                        stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                    </svg>
                                    {{ user_data.location.city }}, {{ user_data.location.country }}
                                </p>
                            </div>
                            {% endif %}

                            {% if user_data.education %}
                            <div>
                                <h3 class="font-medium text-gray-700">Education</h3>
                                <p class="text-gray-900">{{ user_data.education }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Unified Profile Form - Hidden by default -->
                    <div id="unifiedProfileForm"
                        class="bg-white rounded-2xl shadow-sm p-8 space-y-6 profile-editable-section">
                        <h2 class="text-2xl font-bold mb-6">Profile Information</h2>
                        <form method="POST" enctype="multipart/form-data" id="profileForm" class="space-y-6">
                            <!-- Form Fields -->
                            <div class="space-y-4">
                                <div class="form-control">
                                    <label class="label font-bold text-gray-700">Full Name</label>
                                    <input type="text" name="full_name"
                                        class="input input-bordered bg-gray-50 w-full focus:ring-2 focus:ring-black transition-all"
                                        value="{{ user_data.full_name if user_data else '' }}">
                                </div>

                                <div class="form-control">
                                    <label class="label font-bold text-gray-700">Age</label>
                                    <input type="number" name="age" min="13" max="120"
                                        class="input input-bordered bg-gray-50 w-full focus:ring-2 focus:ring-black transition-all"
                                        value="{{ user_data.age if user_data else '' }}" placeholder="Enter your age">
                                </div>

                                <div class="form-control">
                                    <label class="label font-bold text-gray-700">Specialty</label>
                                    <input type="text" name="specialty"
                                        class="input input-bordered bg-gray-50 w-full focus:ring-2 focus:ring-black transition-all"
                                        value="{{ user_data.specialty if user_data else '' }}"
                                        placeholder="e.g., Computer Science, Medicine, Art">
                                </div>

                                <div class="form-control">
                                    <label class="label font-bold text-gray-700">Goals</label>
                                    <textarea name="goals"
                                        class="textarea textarea-bordered bg-gray-50 w-full min-h-[100px] focus:ring-2 focus:ring-black transition-all"
                                        placeholder="What are your academic or professional goals?">{{ user_data.goals if user_data else '' }}</textarea>
                                </div>

                                <div class="form-control">
                                    <label class="label font-bold text-gray-700">Bio</label>
                                    <textarea name="bio"
                                        class="textarea textarea-bordered bg-gray-50 w-full min-h-[100px] focus:ring-2 focus:ring-black transition-all">{{ user_data.bio if user_data else '' }}</textarea>
                                </div>

                                <!-- Skills Section -->
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <h3 class="label font-bold text-gray-700">Skills</h3>
                                        <button onclick="showSkillsEditor()" type="button"
                                            class="text-sm text-purple-600 hover:text-purple-800 font-medium">
                                            Edit Skills
                                        </button>
                                    </div>
                                    <div class="flex flex-wrap gap-2" id="skillsContainer">
                                        {% for skill in user_data.skills %}
                                        <span
                                            class="px-3 py-1 text-sm font-medium bg-purple-50 text-purple-700 rounded-full hover:bg-purple-100 transition-colors">
                                            {{ skill }}
                                        </span>
                                        {% endfor %}
                                    </div>
                                </div>

                                <!-- Location Section -->
                                <div class="space-y-4">
                                    <h3 class="text-lg font-bold text-gray-700">Location</h3>
                                    {% if user_data.location %}
                                    <div class="flex items-center gap-2 text-gray-600 bg-gray-50 p-3 rounded-lg">
                                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                        </svg>
                                        <span data-location class="font-medium">
                                            {{ user_data.location.city }}, {{ user_data.location.country }}
                                        </span>
                                    </div>
                                    {% else %}
                                    <div class="text-gray-500 text-sm bg-gray-50 p-3 rounded-lg">
                                        Location not available
                                    </div>
                                    {% endif %}
                                </div>

                                <div class="form-control">
                                    <label class="label font-bold text-gray-700">Education</label>
                                    {% if user_data.school_id %}
                                    <div class="bg-gray-100 p-4 rounded-lg">
                                        <span class="text-gray-800">{{ user_data.school_name }}</span>
                                    </div>
                                    {% else %}
                                    <textarea name="education"
                                        class="textarea textarea-bordered bg-gray-50 w-full focus:ring-2 focus:ring-black transition-all">{{ user_data.education if user_data else '' }}</textarea>
                                    {% endif %}
                                </div>

                                <h2 class="text-2xl font-bold mt-8 mb-4">Links & Contacts</h2>
                                <div id="linksContainer" class="space-y-4">
                                    {% if user_data.links %}
                                    {% for link in user_data.links %}
                                    <div
                                        class="link-entry group p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-all duration-200">
                                        <div class="flex items-start gap-4">
                                            <div class="link-icon flex-shrink-0 mt-2">
                                                {% if 'linkedin.com' in link.url %}
                                                <svg class="h-8 w-8 text-blue-600" fill="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path
                                                        d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.5867-2.777 7 2.476v6.759z" />
                                                </svg>
                                                {% elif 'github.com' in link.url %}
                                                <svg class="h-8 w-8 text-gray-900" fill="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path
                                                        d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                                                </svg>
                                                {% elif 'youtube.com' in link.url or 'youtu.be' in link.url %}
                                                <svg class="h-8 w-8 text-red-600" fill="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path
                                                        d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z" />
                                                </svg>
                                                {% else %}
                                                <svg class="h-8 w-8 text-gray-500" fill="none" viewBox="0 0 24 24"
                                                    stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                                                </svg>
                                                {% endif %}
                                            </div>
                                            <div class="flex-grow space-y-3">
                                                <input type="text" name="link_titles[]" placeholder="Link Title"
                                                    class="input input-bordered w-full bg-white focus:ring-2 focus:ring-black transition-all"
                                                    value="{{ link.title }}">
                                                <input type="text" name="link_urls[]" placeholder="URL"
                                                    class="input input-bordered w-full bg-white focus:ring-2 focus:ring-black transition-all"
                                                    value="{{ link.url }}">
                                            </div>
                                            <div class="flex-shrink-0 flex items-start space-x-2">
                                                <a href="{{ link.url }}" target="_blank"
                                                    class="btn btn-ghost btn-sm p-2 hover:bg-purple-50 text-purple-600 transition-colors rounded-lg">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                                        viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round"
                                                            stroke-width="2"
                                                            d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                                    </svg>
                                                </a>
                                                <button type="button" onclick="removeLink(this)"
                                                    class="btn btn-ghost btn-sm p-2 hover:bg-red-50 text-red-500 transition-colors rounded-lg">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                                        viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round"
                                                            stroke-width="2"
                                                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                    {% endif %}
                                </div>
                                <button type="button" onclick="addLink()"
                                    class="btn btn-ghost text-purple-600 hover:bg-purple-50 transition-colors px-6">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 4v16m8-8H4" />
                                    </svg>
                                    Add Link
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="md:col-span-2 space-y-8">
                    <div class="bg-white rounded-lg shadow-sm p-6 mb-6 profile-display-section">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold">University Finder</h2>
                            <span class="px-3 py-1 text-sm font-medium bg-blue-100 text-blue-800 rounded-full">
                                New Feature
                            </span>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                            <div class="md:col-span-2">
                                <p class="text-gray-700 mb-4">Find universities that match your academic profile and
                                    career goals. Our AI-powered tool analyzes your GPA, test scores, and skills to
                                    recommend the best universities for you.</p>

                                <div class="bg-indigo-50 rounded-lg p-4 mb-4">
                                    <h3 class="text-indigo-800 font-medium mb-2 flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        How it works
                                    </h3>
                                    <ul class="space-y-2 list-disc list-inside text-indigo-700">
                                        <li>Choose your target country for education</li>
                                        <li>Our AI analyzes your academic profile</li>
                                        <li>Get personalized university recommendations</li>
                                        <li>See your admission chances for each university</li>
                                    </ul>
                                </div>
                            </div>

                            <div
                                class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-5 text-white flex flex-col justify-between">
                                <div>
                                    <h3 class="font-bold text-lg mb-2">Find Your Ideal University</h3>
                                    <p class="opacity-90 mb-4">Personalized recommendations based on your academic
                                        profile and goals</p>
                                </div>

                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="text-xs font-medium opacity-75">Based on your</div>
                                        <div class="font-bold">
                                            {{ academic_info.gpa if academic_info and academic_info.gpa else '?' }} GPA
                                        </div>
                                    </div>

                                    <a href="{{ url_for('university_finder') }}"
                                        class="px-4 py-2 bg-white text-indigo-700 rounded-lg font-medium transform hover:scale-105 transition-transform duration-200">
                                        Find Universities
                                    </a>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="bg-gray-50 rounded-lg p-3 text-center">
                                <div class="text-gray-500 text-xs mb-1">GPA</div>
                                <div class="font-bold">{{ academic_info.gpa if academic_info and academic_info.gpa else
                                    'Not set' }}</div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-3 text-center">
                                <div class="text-gray-500 text-xs mb-1">SAT</div>
                                <div class="font-bold">{{ academic_info.sat_score if academic_info and
                                    academic_info.sat_score else 'Not set' }}</div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-3 text-center">
                                <div class="text-gray-500 text-xs mb-1">TOEFL</div>
                                <div class="font-bold">{{ academic_info.toefl_score if academic_info and
                                    academic_info.toefl_score else 'Not set' }}</div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-3 text-center">
                                <div class="text-gray-500 text-xs mb-1">IELTS</div>
                                <div class="font-bold">{{ academic_info.ielts_score if academic_info and
                                    academic_info.ielts_score else 'Not set' }}</div>
                            </div>
                        </div>

                        <div class="text-center mt-6">
                            <a href="{{ url_for('university_finder') }}"
                                class="btn bg-black hover:bg-gray-800 text-white transform hover:scale-[1.02] transition-all duration-200">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                                Find Universities
                            </a>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm p-6 profile-display-section">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold">Career test</h2>
                            {% if test_completed %}
                            <span class="px-3 py-1 text-sm font-medium bg-green-100 text-green-800 rounded-full">
                                Passed
                            </span>
                            {% else %}
                            <span class="px-3 py-1 text-sm font-medium bg-yellow-100 text-yellow-800 rounded-full">
                                Not passed
                            </span>
                            {% endif %}
                        </div>

                        {% if test_completed %}
                        <!-- Test Completed - Show Results Preview -->
                        <div class="space-y-6">
                            <p class="text-gray-700">Based on your profile, here are the top 3 recommended professions:
                            </p>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                {% for profession in test_results[:3] %}
                                <div class="bg-gray-50 p-4 rounded-lg hover:shadow-md transition-all duration-200">
                                    <div class="flex justify-between items-start mb-2">
                                        <h3 class="font-semibold text-gray-900">{{ profession.name }}</h3>
                                        <span class="text-sm font-bold text-purple-700">{{ profession.compatibility
                                            }}%</span>
                                    </div>
                                    <p class="text-sm text-gray-600 line-clamp-3">{{ profession.description }}</p>
                                </div>
                                {% endfor %}
                            </div>

                            <div class="flex justify-center mt-4">
                                <a href="{{ url_for('career_test_results') }}"
                                    class="btn bg-black hover:bg-gray-800 text-white transform hover:scale-[1.02] transition-all duration-200">
                                    View full results
                                </a>
                            </div>
                        </div>
                        {% else %}
                        <!-- Test Not Completed - Show CTA -->
                        <div class="text-center py-10 bg-gray-50 rounded-xl">
                            <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-gray-400" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                            </svg>
                            <h3 class="mt-4 text-lg font-medium text-gray-900">Determine your career path</h3>
                            <p class="mt-2 text-sm text-gray-500 mb-6">Take our career test and get personalized career
                                recommendations</p>
                            <a href="{{ url_for('career_test') }}"
                                class="btn bg-black hover:bg-gray-800 text-white transform hover:scale-[1.02] transition-all duration-200">
                                Take the career test
                            </a>
                        </div>
                        {% endif %}
                    </div>
                    <!-- Projects Section -->
                    <!-- Projects Section for Personal Profile -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">Projects</h2>
                            <button onclick="showCreateProjectModal()"
                                class="btn bg-black hover:bg-gray-800 text-white transform hover:scale-[1.02] transition-all duration-200 profile-editable-section">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v16m8-8H4" />
                                </svg>
                                Add Project
                            </button>
                        </div>

                        {% if projects %}
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                            {% for project in projects %}
                            <div
                                class="group relative bg-white border border-gray-200 rounded-xl overflow-hidden hover:shadow-md transition-all duration-300">
                                <!-- Header and Logo Container -->
                                <div class="relative h-48">
                                    <!-- Header background -->
                                    <div class="absolute inset-0 bg-gradient-to-r from-gray-100 to-gray-200">
                                        {% if project.header_image %}
                                        <img src="{{ project.header_image }}" alt="{{ project.title }}"
                                            class="w-full h-full object-cover opacity-70">
                                        {% endif %}
                                    </div>

                                    <!-- Overlay for better contrast -->
                                    <div
                                        class="absolute inset-0 bg-gradient-to-t from-black/30 to-transparent opacity-70">
                                    </div>

                                    <!-- Centered logo/thumbnail with background -->
                                    <div class="absolute inset-0 flex items-center justify-center">
                                        {% if project.thumbnail %}
                                        <div
                                            class="bg-white/90 p-3 rounded-lg shadow-sm transform group-hover:scale-105 transition-all">
                                            <img src="{{ project.thumbnail }}" alt="{{ project.title }}"
                                                class="h-24 w-auto object-contain max-w-[120px]">
                                        </div>
                                        {% else %}
                                        <div
                                            class="w-20 h-20 flex items-center justify-center bg-white rounded-full shadow-md text-2xl font-bold">
                                            {{ project.title[0] }}
                                        </div>
                                        {% endif %}
                                    </div>

                                    <!-- Add role badge -->
                                    {% if project.role == 'collaborator' %}
                                    <div
                                        class="absolute top-2 right-2 px-2 py-1 bg-purple-500 text-white text-xs font-medium rounded-full">
                                        Collaborator
                                    </div>
                                    {% endif %}
                                </div>

                                <div class="p-6">
                                    <div class="flex justify-between items-start mb-2">
                                        <h3
                                            class="text-lg font-semibold text-gray-900 group-hover:text-black transition-colors">
                                            {{ project.title }}
                                        </h3>
                                        {% if project.github_url %}
                                        <a href="{{ project.github_url }}" target="_blank"
                                            class="text-gray-500 hover:text-gray-800">
                                            <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24">
                                                <path
                                                    d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                                            </svg>
                                        </a>
                                        {% endif %}
                                    </div>
                                    <p class="text-sm text-gray-600 line-clamp-2 mb-3">{{ project.description }}</p>

                                    {% if project.tags and project.tags|length > 0 %}
                                    <div class="flex flex-wrap gap-2 mb-3">
                                        {% for tag in project.tags %}
                                        <span
                                            class="px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded-full">{{
                                            tag }}</span>
                                        {% endfor %}
                                    </div>
                                    {% endif %}

                                    <!-- Team/Collaborators Section -->
                                    <div class="mt-3 mb-4">
                                        {% if project.role == 'collaborator' %}
                                        <!-- When I'm a collaborator, show the creator and my teammates differently -->
                                        <div class="flex flex-col gap-2">
                                            <!-- Creator first -->
                                            <div class="flex items-center text-xs">
                                                <span class="text-gray-500 mr-2">Creator:</span>
                                                {% if project.creator %}
                                                <a href="/{{ project.creator.username }}" class="flex items-center">
                                                    <img class="w-5 h-5 rounded-full mr-1"
                                                        src="{{ project.creator.avatar }}"
                                                        alt="{{ project.creator.username }}">
                                                    <span class="text-gray-700">{{ project.creator.username }}</span>
                                                </a>
                                                {% else %}
                                                <span class="text-gray-600">Unknown</span>
                                                {% endif %}
                                            </div>

                                            <!-- Other team members -->
                                            {% if project.collaborators and project.collaborators|length > 0 %}
                                            <div class="flex items-center text-xs">
                                                <span class="text-gray-500 mr-2">Team:</span>
                                                <div class="flex -space-x-2">
                                                    {% for collaborator in project.collaborators %}
                                                    <div class="tooltip" data-tip="{{ collaborator.username }}">
                                                        <div
                                                            class="collaborator-avatar-container h-6 w-6 rounded-full ring-2 ring-white overflow-hidden">
                                                            <img src="{{ collaborator.avatar }}"
                                                                alt="{{ collaborator.username }}"
                                                                class="w-full h-full object-cover small-avatar">
                                                        </div>
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                            {% endif %}
                                        </div>
                                        {% else %}
                                        <!-- Standard collaborators display when I'm the creator -->
                                        {% if project.collaborators and project.collaborators|length > 0 %}
                                        <div class="flex items-center gap-2">
                                            <span class="text-xs text-gray-500">Collaborators:</span>
                                            <div class="flex -space-x-2">
                                                {% for collaborator in project.collaborators %}
                                                <div class="tooltip" data-tip="{{ collaborator.username }}">
                                                    <div
                                                        class="collaborator-avatar-container h-6 w-6 rounded-full ring-2 ring-white overflow-hidden">
                                                        <img src="{{ collaborator.avatar }}"
                                                            alt="{{ collaborator.username }}"
                                                            class="collaborator-avatar w-full h-full object-cover small-avatar">
                                                    </div>
                                                </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                        {% endif %}
                                        {% endif %}
                                    </div>

                                    <div class="flex justify-between items-center">
                                        <a href="{{ url_for('view_project', project_id=project.id) }}"
                                            class="text-sm font-medium text-purple-600 hover:text-purple-800 transition-colors">
                                            View Project
                                        </a>
                                        <div class="flex items-center space-x-2">
                                            <!-- Only show edit/delete if user is creator -->
                                            {% if project.role != 'collaborator' %}
                                            <button onclick="editProject('{{ project.id }}')"
                                                class="text-gray-500 hover:text-gray-700 profile-editable-section">
                                                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                                    stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                                                </svg>
                                            </button>
                                            <button onclick="deleteProject('{{ project.id }}')"
                                                class="text-gray-500 hover:text-red-500 profile-editable-section">
                                                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                                    stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                </svg>
                                            </button>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-12 bg-gray-50 rounded-xl">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z" />
                            </svg>
                            <h3 class="mt-4 text-lg font-medium text-gray-900">No projects yet</h3>
                            <p class="mt-2 text-sm text-gray-500">Showcase your work by adding your first project</p>
                        </div>
                        {% endif %}
                    </div>
                    <!-- Certificates Section - Always visible -->
                    <div class="bg-white rounded-2xl shadow-sm p-8">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">Certificates</h2>
                            <button onclick="showUploadModal()"
                                class="btn bg-black hover:bg-gray-800 text-white transform hover:scale-[1.02] transition-all duration-200 profile-editable-section">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v16m8-8H4" />
                                </svg>
                                Add Certificate
                            </button>
                        </div>

                        {% if certificates %}
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                            {% for cert_doc in certificates %}
                            {% set cert = cert_doc.to_dict() %}
                            <div
                                class="group relative bg-gray-50 rounded-xl overflow-hidden hover:shadow-md transition-all duration-300">
                                {% if cert.file_url and (cert.file_url.endswith('.jpg') or
                                cert.file_url.endswith('.jpeg') or cert.file_url.endswith('.png')) %}
                                <div class="relative h-48">
                                    <img src="{{ cert.file_url }}" alt="{{ cert.title }}"
                                        class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105">
                                    <div
                                        class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                    </div>
                                </div>
                                {% else %}
                                <div
                                    class="h-48 flex items-center justify-center bg-gray-100 group-hover:bg-gray-200 transition-colors duration-300">
                                    <svg class="h-16 w-16 text-gray-400" fill="none" viewBox="0 0 24 24"
                                        stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                </div>
                                {% endif %}

                                <div class="p-6 space-y-4">
                                    <h3
                                        class="text-lg font-semibold text-gray-900 group-hover:text-black transition-colors">
                                        {{ cert.title }}
                                    </h3>
                                    {% if cert.uploaded_at %}
                                    <p class="text-sm text-gray-500">
                                        {{ cert.uploaded_at.strftime('%B %d, %Y') }}
                                    </p>
                                    {% endif %}
                                    <div class="flex justify-between items-center">
                                        <a href="{{ cert.file_url }}" target="_blank"
                                            class="btn btn-sm bg-black hover:bg-gray-800 text-white transform hover:scale-[1.02] transition-all duration-200">
                                            View Certificate
                                        </a>
                                        <button onclick="deleteCertificate('{{ cert_doc.id }}')"
                                            class="btn btn-sm btn-ghost text-red-500 hover:bg-red-50 transition-colors profile-editable-section">
                                            Delete
                                        </button>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-12 bg-gray-50 rounded-xl">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <h3 class="mt-4 text-lg font-medium text-gray-900">No certificates yet</h3>
                            <p class="mt-2 text-sm text-gray-500">Add your first certificate to showcase your
                                achievements</p>

                        </div>
                        {% endif %}
                    </div>





                    <!-- Academic Portfolio -->
                    <div class="bg-white rounded-2xl shadow-sm p-8 profile-editable-section">
                        <h2 class="text-2xl font-bold mb-8">Academic Portfolio</h2>
                        <form id="academicPortfolioForm" class="space-y-8">
                            <!-- Academic Scores -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="form-control">
                                    <label class="label font-medium text-gray-700">GPA</label>
                                    <input type="text" name="gpa" placeholder="Enter your GPA"
                                        class="input input-bordered bg-gray-50 w-full focus:ring-2 focus:ring-black transition-all"
                                        value="{{ user_data.academic_info.gpa }}">
                                </div>

                                <div class="form-control">
                                    <label class="label font-medium text-gray-700">SAT Score</label>
                                    <input type="text" name="sat_score" placeholder="Enter SAT Score"
                                        class="input input-bordered bg-gray-50 w-full focus:ring-2 focus:ring-black transition-all"
                                        value="{{ user_data.academic_info.sat_score }}">
                                </div>

                                <div class="form-control">
                                    <label class="label font-medium text-gray-700">TOEFL Score</label>
                                    <input type="text" name="toefl_score" placeholder="TOEFL Score"
                                        class="input input-bordered bg-gray-50 w-full focus:ring-2 focus:ring-black transition-all"
                                        value="{{ user_data.academic_info.toefl_score }}">
                                </div>

                                <div class="form-control">
                                    <label class="label font-medium text-gray-700">IELTS Score</label>
                                    <input type="text" name="ielts_score" placeholder="IELTS Score"
                                        class="input input-bordered bg-gray-50 w-full focus:ring-2 focus:ring-black transition-all"
                                        value="{{ user_data.academic_info.ielts_score }}">
                                </div>
                            </div>

                            <!-- Languages Section -->
                            <div class="space-y-6">
                                <h3 class="text-xl font-semibold">Languages</h3>
                                <div id="languagesContainer" class="space-y-4">
                                    {% for language in user_data.academic_info.languages %}
                                    <div
                                        class="flex gap-4 p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-all duration-200">
                                        <input type="text" name="language_name" placeholder="Language"
                                            class="input input-bordered flex-1 bg-white focus:ring-2 focus:ring-black transition-all"
                                            value="{{ language.name }}">
                                        <select name="language_level"
                                            class="select select-bordered bg-white focus:ring-2 focus:ring-black transition-all">
                                            <option value="A1" {% if language.level=='A1' %}selected{% endif %}>A1 -
                                                Beginner</option>
                                            <option value="A2" {% if language.level=='A2' %}selected{% endif %}>A2 -
                                                Elementary</option>
                                            <option value="B1" {% if language.level=='B1' %}selected{% endif %}>B1 -
                                                Intermediate</option>
                                            <option value="B2" {% if language.level=='B2' %}selected{% endif %}>B2 -
                                                Upper Intermediate</option>
                                            <option value="C1" {% if language.level=='C1' %}selected{% endif %}>C1 -
                                                Advanced</option>
                                            <option value="C2" {% if language.level=='C2' %}selected{% endif %}>C2 -
                                                Mastery</option>

                                        </select>
                                        <button type="button" onclick="removeLanguage(this)"
                                            class="btn btn-ghost text-red-500 hover:bg-red-50 transition-colors">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                                viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                            </svg>
                                        </button>
                                    </div>
                                    {% endfor %}
                                </div>
                                <button type="button" id="addLanguageBtn"
                                    class="btn bg-black hover:bg-gray-800 text-white transform hover:scale-[1.02] transition-all duration-200">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 4v16m8-8H4" />
                                    </svg>
                                    Add Language
                                </button>
                            </div>

                            <!-- Achievements Section -->
                            <div class="space-y-6">
                                <h3 class="text-xl font-semibold">Achievements</h3>
                                <div id="achievementsContainer" class="space-y-4">
                                    {% for achievement in user_data.academic_info.achievements %}
                                    <div
                                        class="p-6 bg-gray-50 rounded-xl hover:bg-gray-100 transition-all duration-200">
                                        <div class="space-y-4">
                                            <input type="text" name="achievement_title" placeholder="Achievement Title"
                                                class="input input-bordered w-full bg-white focus:ring-2 focus:ring-black transition-all"
                                                value="{{ achievement.title }}">
                                            <textarea name="achievement_description" placeholder="Description"
                                                class="textarea textarea-bordered w-full bg-white focus:ring-2 focus:ring-black transition-all min-h-[100px]">{{ achievement.description }}</textarea>
                                            <div class="flex items-center justify-between">
                                                <input type="date" name="achievement_date"
                                                    class="input input-bordered bg-white focus:ring-2 focus:ring-black transition-all"
                                                    value="{{ achievement.date }}">
                                                <button type="button" onclick="removeAchievement(this)"
                                                    class="btn btn-ghost text-red-500 hover:bg-red-50 transition-colors">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                                        viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round"
                                                            stroke-width="2"
                                                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                <button type="button" id="addAchievementBtn"
                                    class="btn bg-black hover:bg-gray-800 text-white transform hover:scale-[1.02] transition-all duration-200">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 4v16m8-8H4" />
                                    </svg>
                                    Add Achievement
                                </button>
                            </div>

                            <!-- Floating Save Button - Unified -->
                            <button id="floatingSaveBtn"
                                class="btn bg-black hover:bg-gray-800 text-white w-full transform hover:scale-[1.02] transition-all duration-200">
                                <div class="save-btn-content">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M5 13l4 4L19 7" />
                                    </svg>
                                    <span>Save All Changes</span>
                                </div>
                            </button>

                        </form>

                    </div>
                </div>
            </div>

            <div id="profileLoadingOverlay" class="profile-loading">
                <div class="text-center">
                    <div class="w-12 h-12 border-t-4 border-b-4 border-black rounded-full animate-spin mx-auto"></div>
                    <p class="mt-4 text-gray-600">Loading your profile...</p>
                </div>
            </div>
        </div>
    </div>

</div>


<!-- Modals -->
<!-- Upload Certificate Modal -->
<!-- Add this section to your profile.html right before the </body> tag -->
<!-- This will help you debug collaborator issues -->

<div id="debugOutput"
    class="fixed bottom-0 right-0 bg-black bg-opacity-80 text-white p-4 max-w-lg max-h-64 overflow-auto hidden">
    <div class="flex justify-between items-center mb-2">
        <h3 class="text-sm font-bold">Debug Information</h3>
        <button onclick="document.getElementById('debugOutput').classList.add('hidden')" class="text-white">
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
    </div>
    <pre id="debugContent" class="text-xs whitespace-pre-wrap"></pre>
</div>

<div id="uploadModal" class="modal">
    <div class="modal-box max-w-2xl p-8 relative">
        <h3 class="text-2xl font-bold mb-6">Upload Certificate</h3>
        <form id="certificateForm" class="space-y-6">
            <div class="form-control">
                <label class="label font-medium text-gray-700">Certificate Title</label>
                <input type="text" id="certTitle" name="title"
                    class="input input-bordered bg-gray-50 w-full focus:ring-2 focus:ring-black transition-all"
                    required>
            </div>

            <div class="form-control">
                <label class="label font-medium text-gray-700">Certificate File</label>
                <div class="relative">
                    <input type="file" name="certificate" accept=".pdf,.jpg,.jpeg,.png"
                        class="file-input file-input-bordered w-full bg-gray-50 focus:ring-2 focus:ring-black transition-all"
                        onchange="previewCertificate(this)" required>
                </div>
            </div>

            <div id="previewContainer" class="hidden mt-4">
                <img id="imagePreview" class="max-h-48 mx-auto rounded-lg" alt="Preview">
            </div>

            <div class="flex justify-end gap-4 mt-8">
                <button type="button" onclick="closeUploadModal()"
                    class="btn btn-ghost hover:bg-gray-100 transition-colors">Cancel</button>
                <button type="submit"
                    class="btn bg-black hover:bg-gray-800 text-white transform hover:scale-[1.02] transition-all duration-200">
                    Upload Certificate
                </button>
            </div>
        </form>
    </div>

</div>
<!-- Add this at the end of the body in profile.html (before closing body tag) -->

<!-- Project Create/Edit Modal -->
<!-- Add this inside the project modal in profile.html -->
<div id="projectModal" class="modal">
    <div class="modal-box max-w-4xl p-8 relative">
        <h3 id="projectModalTitle" class="text-2xl font-bold mb-6">Create New Project</h3>
        <form id="projectForm" class="space-y-6">
            <input type="hidden" id="projectId" name="project_id" value="">

            <!-- Basic Information -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="form-control md:col-span-2">
                    <label class="label font-bold text-gray-700">Project Title*</label>
                    <input type="text" id="projectTitle" name="title" required
                        class="input input-bordered bg-gray-50 w-full focus:ring-2 focus:ring-black transition-all">
                </div>

                <div class="form-control md:col-span-2">
                    <label class="label font-bold text-gray-700">Description*</label>
                    <textarea id="projectDescription" name="description" required
                        class="textarea textarea-bordered bg-gray-50 w-full min-h-[120px] focus:ring-2 focus:ring-black transition-all"
                        placeholder="Describe your project..."></textarea>
                </div>

                <div class="form-control">
                    <label class="label font-bold text-gray-700">GitHub URL</label>
                    <input type="url" id="projectGithub" name="github_url"
                        class="input input-bordered bg-gray-50 w-full focus:ring-2 focus:ring-black transition-all"
                        placeholder="https://github.com/yourusername/repository">
                </div>

                <div class="form-control">
                    <label class="label font-bold text-gray-700">Project URL</label>
                    <input type="url" id="projectUrl" name="project_url"
                        class="input input-bordered bg-gray-50 w-full focus:ring-2 focus:ring-black transition-all"
                        placeholder="https://yourproject.com">
                </div>
            </div>

            <!-- Project Header and Thumbnail -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="form-control">
                    <label class="label font-bold text-gray-700">Project Thumbnail</label>
                    <div class="flex items-center space-x-4">
                        <div id="thumbnailPreviewContainer"
                            class="relative w-24 h-24 bg-gray-200 rounded-lg overflow-hidden border-2 border-gray-300">
                            <img id="thumbnailPreview" src="/static/placeholder.png" alt="Thumbnail"
                                class="w-full h-full object-cover">
                            <div
                                class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-30 flex items-center justify-center transition-all duration-200">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                    class="h-8 w-8 text-white opacity-0 group-hover:opacity-100" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                            </div>
                        </div>
                        <div class="flex-1">
                            <input type="file" id="thumbnailInput" name="thumbnail" accept="image/*"
                                class="file-input file-input-bordered w-full max-w-xs"
                                onchange="previewThumbnail(this)">
                            <p class="text-xs text-gray-500 mt-2">Recommended size: 200x200px. Max size: 2MB</p>
                        </div>
                    </div>
                </div>

                <div class="form-control">
                    <label class="label font-bold text-gray-700">Project Header</label>
                    <div class="flex items-center space-x-4">
                        <div id="headerPreviewContainer"
                            class="relative w-full h-32 bg-gray-200 rounded-lg overflow-hidden border-2 border-gray-300">
                            <img id="headerPreview" src="/static/placeholder-wide.png" alt="Header"
                                class="w-full h-full object-cover">
                            <div
                                class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-30 flex items-center justify-center transition-all duration-200">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                    class="h-8 w-8 text-white opacity-0 group-hover:opacity-100" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                            </div>
                        </div>
                        <div class="flex-1">
                            <input type="file" id="headerInput" name="header_image" accept="image/*"
                                class="file-input file-input-bordered w-full max-w-xs" onchange="previewHeader(this)">
                            <p class="text-xs text-gray-500 mt-2">Recommended size: 1200x400px. Max size: 5MB</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Project Tags -->
            <div class="form-control">
                <label class="label font-bold text-gray-700">Tags</label>
                <div class="flex flex-wrap gap-2" id="tagsContainer">
                    <!-- Tags will be added here -->
                </div>
                <div class="flex mt-2">
                    <input type="text" id="tagInput" placeholder="Add a tag..."
                        class="input input-bordered bg-gray-50 flex-grow focus:ring-2 focus:ring-black transition-all">
                    <button type="button" onclick="addTag()"
                        class="ml-2 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">
                        Add
                    </button>
                </div>
            </div>

            <!-- Project Images -->
            <div class="form-control">
                <label class="label font-bold text-gray-700">Project Images</label>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-2" id="imagesContainer">
                    <!-- Image previews will be added here -->
                </div>
                <div class="relative mt-2">
                    <input type="file" id="projectImages" multiple accept="image/*"
                        class="file-input file-input-bordered w-full bg-gray-50 focus:ring-2 focus:ring-black transition-all"
                        onchange="previewProjectImages(this)">
                </div>
            </div>

            <!-- Collaborators Section -->
            <div class="form-control">
                <label class="label font-bold text-gray-700">Collaborators</label>
                <div class="space-y-4" id="collaboratorsContainer">
                    <!-- Collaborators will be added here -->
                </div>
                <div class="flex mt-2">
                    <input type="text" id="collaboratorInput" placeholder="Search username..."
                        class="input input-bordered bg-gray-50 flex-grow focus:ring-2 focus:ring-black transition-all">
                    <button type="button" onclick="searchUsers()"
                        class="ml-2 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">
                        Search
                    </button>
                </div>
                <!-- Search results will appear here -->
                <div id="userSearchResults"
                    class="mt-2 bg-white border border-gray-200 rounded-lg max-h-40 overflow-y-auto hidden">
                    <!-- User search results will appear here -->
                </div>
            </div>

            <div class="flex justify-end gap-4 mt-8">
                <button type="button" onclick="closeProjectModal()"
                    class="btn btn-ghost hover:bg-gray-100 transition-colors">
                    Cancel
                </button>
                <button type="submit"
                    class="btn bg-black hover:bg-gray-800 text-white transform hover:scale-[1.02] transition-all duration-200">
                    Save Project
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Delete Project Confirmation Modal -->
<div id="deleteProjectModal" class="modal">
    <div class="modal-box p-6">
        <h3 class="font-bold text-lg mb-4">Confirm Deletion</h3>
        <p>Are you sure you want to delete this project? This action cannot be undone.</p>
        <input type="hidden" id="projectToDelete" value="">
        <div class="modal-action mt-6">
            <button class="btn btn-ghost" onclick="closeDeleteProjectModal()">Cancel</button>
            <button id="confirmDeleteProjectBtn" class="btn bg-red-500 hover:bg-red-600 text-white">Delete</button>
        </div>
    </div>
</div>
<!-- Skills Editor Modal -->
<div id="skillsModal" class="modal">
    <div class="modal-box max-w-2xl p-8">
        <h3 class="text-2xl font-bold mb-6">Edit Skills</h3>
        <div class="space-y-6">
            <div id="skillsList" class="space-y-4">
                <!-- Skills will be added here -->
            </div>
            <button type="button" onclick="addNewSkill(event)"
                class="btn btn-ghost text-purple-600 hover:bg-purple-50 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                Add Skill
            </button>
        </div>
        <div class="flex justify-end gap-4 mt-8">
            <button type="button" onclick="closeSkillsModal(event)"
                class="btn btn-ghost hover:bg-gray-100 transition-colors">Cancel</button>
            <button type="button" onclick="saveSkills(event)"
                class="btn bg-black hover:bg-gray-800 text-white transform hover:scale-[1.02] transition-all duration-200">
                Save Changes
            </button>
        </div>
    </div>
</div>

<!-- Delete Certificate Confirmation Modal -->
<div id="deleteCertificateModal" class="modal">
    <div class="modal-box p-6">
        <h3 class="font-bold text-lg mb-4">Confirm Deletion</h3>
        <p>Are you sure you want to delete this certificate? This action cannot be undone.</p>
        <input type="hidden" id="certificateToDelete" value="">
        <div class="modal-action mt-6">
            <button class="btn btn-ghost" onclick="closeDeleteCertificateModal()">Cancel</button>
            <button id="confirmDeleteBtn" class="btn bg-red-500 hover:bg-red-600 text-white">Delete</button>
        </div>
    </div>
</div>











<script src="{{ url_for('static', filename='js/core.js') }}"></script>
<script src="{{ url_for('static', filename='js/profile.js') }}"></script>
<script src="{{ url_for('static', filename='js/academic.js') }}"></script>
<script src="{{ url_for('static', filename='js/skills.js') }}"></script>
<script src="{{ url_for('static', filename='js/projects.js') }}"></script>

<script>
    // Define a global variable with the current username
    const currentUsername = "{{ user_data.username if user_data else '' }}";

    function copyProfileLink() {
        if (!currentUsername) {
            showNotification('Username not found. Please reload the page and try again.', 'error');
            return;
        }

        const profileLink = window.location.origin + '/' + currentUsername;

        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(profileLink)
                .then(() => {
                    showNotification('Profile link copied to clipboard!');
                })
                .catch(err => {
                    console.error('Failed to copy: ', err);
                    showNotification('Failed to copy link', 'error');
                });
        } else {
            // Create textarea element for fallback
            const textArea = document.createElement("textarea");
            textArea.value = profileLink;
            textArea.style.position = "fixed";
            textArea.style.left = "-999999px";
            textArea.style.top = "-999999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                document.execCommand('copy');
                showNotification('Profile link copied to clipboard!');
            } catch (err) {
                showNotification('Failed to copy link', 'error');
            }

            document.body.removeChild(textArea);
        }
    }

    // Make sure all copy buttons use this new function
    document.addEventListener('DOMContentLoaded', function () {
        const copyBtns = document.querySelectorAll('button[onclick="copyProfileLink()"]');
        copyBtns.forEach(btn => {
            btn.onclick = function (e) {
                e.preventDefault();
                copyProfileLink();
            };
        });
    });
</script>
<script>
    // Status update functionality
    function showStatusEditor() {
        document.getElementById('statusDisplay').classList.add('hidden');
        document.getElementById('statusEditor').classList.remove('hidden');

        // Focus on textarea
        document.getElementById('statusText').focus();
    }

    function cancelStatusEdit() {
        document.getElementById('statusDisplay').classList.remove('hidden');
        document.getElementById('statusEditor').classList.add('hidden');
    }

    // Character counter for status
    document.getElementById('statusText')?.addEventListener('input', function () {
        const length = this.value.length;
        const charCountElement = document.getElementById('statusCharCount');
        charCountElement.textContent = `${length} / 280`;

        // Change color when approaching limit
        if (length > 240) {
            charCountElement.classList.add('text-orange-500');
        } else if (length > 260) {
            charCountElement.classList.add('text-red-500');
        } else {
            charCountElement.classList.remove('text-orange-500', 'text-red-500');
        }
    });

    async function saveStatus() {
        const statusText = document.getElementById('statusText').value;

        try {
            const response = await fetch('/update-status', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ status: statusText })
            });

            const data = await response.json();

            if (data.success) {
                // Update the displayed status
                const currentStatus = document.getElementById('currentStatus');
                if (statusText.trim()) {
                    currentStatus.textContent = statusText;
                    currentStatus.classList.remove('text-gray-500', 'italic');
                } else {
                    currentStatus.textContent = 'No status set. Share what you\'re working on or thinking about.';
                    currentStatus.classList.add('text-gray-500', 'italic');
                }

                // Hide editor
                cancelStatusEdit();

                // Show success notification
                showNotification('Status updated successfully');
            } else {
                throw new Error(data.error || 'Failed to update status');
            }
        } catch (error) {
            showNotification(error.message, 'error');
        }
    }
</script>

{% endblock %}